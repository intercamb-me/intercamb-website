<ng-template #fieldPopoverTemplate>
  <form #form="ngForm" (ngSubmit)="addField()" novalidate>
    <div class="form-row">
      <div class="col form-group mb-0">
        <label for="field-name">Nome</label>
        <input
          [(ngModel)]="newField.name"
          id="field-name"
          name="field-name"
          type="text"
          class="form-control"
          autofocus
          required>
      </div>
      <div class="col form-group mb-0">
        <label for="field-type">Tipo</label>
        <select
          [(ngModel)]="newField.type"
          id="field-type"
          name="field-type"
          class="form-control"
          placeholder="Tipo"
          required>
          <option *ngFor="let type of fieldTypes" [ngValue]="type.id">{{ type.name }}</option>
        </select>
      </div>
      <div class="col-auto form-group d-flex flex-column justify-content-end mb-0">
        <button
          [disabled]="form.invalid"
          class="btn btn-primary"
          type="submit">
          Adicionar
        </button>
      </div>
    </div>
  </form>
</ng-template>
<ng-template #checklistPopoverTemplate>
  <form #form="ngForm" (ngSubmit)="addChecklist()" novalidate>
    <div class="form-row">
      <div class="col form-group mb-0">
        <input
          [(ngModel)]="newChecklist.title"
          name="checklist-title"
          type="text"
          class="form-control"
          placeholder="TÃ­tulo"
          autofocus
          required>
      </div>
      <div class="col-auto form-group mb-0">
        <button
          [disabled]="form.invalid"
          class="btn btn-primary"
          type="submit">
          Adicionar
        </button>
      </div>
    </div>
  </form>
</ng-template>

<div id="edit-default-task">
  <form #form="ngForm" novalidate>
    <div class="modal-header">
      <h4 class="modal-title">
        <input
          [(ngModel)]="defaultTask.name"
          [readonly]="!editingTaskName"
          (focus)="editTaskName()"
          (blur)="stopEditingTaskName()"
          (keydown.enter)="stopEditingTaskName()"
          name="task-name"
          class="task-name editable form-control"
          type="text"
          required>
      </h4>
      <button (click)="close()" type="button" class="close" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <h5 class="mb-3">Campos</h5>
      <div class="mb-3">
        <button
          #fieldPopover
          [ngbPopover]="fieldPopoverTemplate"
          [autoClose]="'outside'"
          [ngClass]="{'mb-3': defaultTask.fields.length > 0}"
          placement="bottom"
          class="btn btn-primary"
          type="button">
          <fa-icon [icon]="['fas', 'list']" [fixedWidth]="true"></fa-icon>
          <span class="ml-2">Adicionar campo</span>
        </button>
        <app-task-fields
          [fields]="defaultTask.fields"
          (fieldsChanges)="onFieldsChanged($event)"
          (statusChanges)="onFieldsStatusChanged($event)">
        </app-task-fields>
      </div>
      <h5 class="mb-3">Checklists</h5>
      <button
        #checklistPopover
        [ngbPopover]="checklistPopoverTemplate"
        [autoClose]="'outside'"
        [ngClass]="{'mb-3': defaultTask.checklists.length > 0}"
        placement="bottom"
        class="btn btn-primary"
        type="button">
        <fa-icon [icon]="['fas', 'list']" [fixedWidth]="true"></fa-icon>
        <span class="ml-2">Adicionar checklist</span>
      </button>
      <app-task-checklists
        [checklists]="defaultTask.checklists"
        (checklistsChanges)="onChecklistsChanged($event)"
        (statusChanges)="onChecklistsStatusChanged($event)">
      </app-task-checklists>
    </div>
    <div class="modal-footer">
      <button
        [disabled]="form.invalid || !fieldsValid || !checklistsValid"
        (click)="backToDefaultTasks()"
        class="btn btn-secondary"
        type="button">
        Voltar
      </button>
    </div>
  </form>
</div>
